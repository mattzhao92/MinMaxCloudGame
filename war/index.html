<!DOCTYPE html>
<html lang="en">
<head>
  <style>
  * {
  	margin: 0;
  	padding: 0;
  }

  .ui-dialog-titlebar {
  	background: #000;
  }

  #container {
  	position: absolute;
  	top: 0;
  	left: 0;
  	height: 100%;
  	width: 100%;
  	z-index: 0;
  }
  </style>
  	<meta charset="utf-8" />
  	<title>TicTacToe</title>
    <script type="text/javascript" src="/_ah/channel/jsapi"></script>

  	<script type="text/javascript" src="js/lib/three.js"></script>
  	<script src="js/lib/helvetiker_regular.typeface.js"></script>
  	<script src="js/lib/janda_manatee_solid_regular.typeface.js""></script>
  	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
  	<script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
  	<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/smoothness/jquery-ui.css" />
  	<script type="text/javascript" src="js/lib/class.js"></script>
  	<script type="text/javascript" src="js/lib/MapControls.js"></script>
  	<script type="text/javascript" src="js/grid.js"></script>
  <script type="text/javascript" src="js/app.js"></script>

</head>

<div id="play" align="center"
	style="opacity: 1; font-family: CoustardRegular, Georgia, serif; font-size: 30px; position: absolute; -webkit-transform-origin: 50% 50%; display: block; box-shadow: rgba(0, 0, 0, 0.14902) -2px 2px 10px; pointer-events: auto; -webkit-transform: translate(670px, 300px); cursor: pointer; color: rgb(51, 51, 51); background-color: rgb(238, 238, 238); width: 160px; height: 160px; border-top-left-radius: 80px; border-top-right-radius: 80px; border-bottom-right-radius: 80px; border-bottom-left-radius: 80px;">
	<div id="play_text"
		style="position: absolute; -webkit-transform-origin: 50% 50%; pointer-events: none; -webkit-transform: translate(44px, 60px);">Play</div>
</div>

<body>
	<div id="content">
		<div id="container"></div>
		<div id="Input-dialog" title="Join Game"></div>

	</div>
</body>

<script type="text/javascript">


    function startGame(playername) {
        $.get("http://localhost:8888/joinGameServlet", ("playername="+playername), function(resp){
        resp = JSON.parse(resp);
            console.log(resp);
          if (resp.status == "success") {
        
            var msg = JSON.parse(resp.msg);
            var channelToken = msg.token;
            var divider = msg.divider;

            console.log(">>>>>>> divider "+divider);
            
            flappyMMCJ.model.playername = playername;

            flappyMMCJ.model.setupChannel(channelToken, function() {
                gameView.setPlayerName(playername);
                $('#container').show();
                if (msg.enableMouse)
                  gameView.enableMouseListeners();
                else
                  gameView.disableMouseListeners();
            });
          }
        });
    }

    function promptUserName() {
        $('#play').hide();
        var content = '<div style="margin:0"><div>';
        content += '<form> <label for="uname" style="margin-left:7">name</label><input id="uname" name="name"  maxlength="15" type="text" style="margin-left: 25"/>';
        content += '</select></div>';
        content += '<input type="button" value="Start" style="margin: 5 23 10 29" id="unameBtn"/><input value="Quit" type="button" id="quitBtn" style="margin: 0 23 14 29"/>';
        content += '</form></div></div>';
        
        $("#Input-dialog").html(content).dialog(
        {
          width: 400, 
          // height: 400,
          modal: true,
          resizable: false,
          dialogClass: 'name-dialog'
        });
         
        $("#Input-dialog").css('padding', 0);
        
        $("#unameBtn").click(function() {
          var username = $('#uname').val();
          if (username != '') {
            $("#Input-dialog").dialog("close");
            startGame(username);
          } else {
            alert('The username can not be empty');
          }
        });
        
        $("#quitBtn").click(function() {
          $("#Input-dialog").dialog("close");
          $('#play').show();
        });

        $('form').on('submit', function(event){
          event.preventDefault();
        });

        $('#Input-dialog').keypress(function(e) {
          if (e.keyCode == $.ui.keyCode.ENTER) {
            $("#unameBtn").click();
            $( "#Input-dialog" ).off("keypress");
          }
        });
    }

    $('#container').hide();
  	var myButton = document.getElementById('play');
	  var handler = function(){
   		promptUserName();
	  }
	  myButton.addEventListener('click', handler);
	
  </script>
</html>
